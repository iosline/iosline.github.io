<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/"/>

  <title> Hexo </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Hexo</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/02/24/通知学习之自定义通知/" itemprop="url">
                  通知学习之自定义通知
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-02-24T16:23:17+08:00" content="2016-02-24">
              2016-02-24
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>实现自定义的通知栏效果：</p>
<p>主要要用到RemoteViews这个类</p>
<h4 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h4><p>Notification的自定义布局是RemoteViews，和其他RemoteViews一样，在自定义视图布局文件中，仅支持FrameLayout、LinearLayout、RelativeLayout三种布局控件和AnalogClock、Chronometer、Button、ImageButton、ImageView、ProgressBar、TextView、ViewFlipper、ListView、GridView、StackView和AdapterViewFlipper这些显示控件，不支持这些类的子类或Android提供的其他控件。否则会引起ClassNotFoundException异常</p>
<h4 id="步骤如下："><a href="#步骤如下：" class="headerlink" title="步骤如下："></a>步骤如下：</h4><p><li>1）创建自定义视图</li></p>
<p><li>2）获取远程视图对象（注：Notification的contentView不能为空）</li></p>
<p><li>3）设置PendingIntent（来响应各种事件）</li></p>
<p><li>4）发起Notification</li></p>
<h3 id="代码模块："><a href="#代码模块：" class="headerlink" title="代码模块："></a>代码模块：</h3><p>样式：</p>
<h4 id="1-自定义带按钮通知栏-如下样式"><a href="#1-自定义带按钮通知栏-如下样式" class="headerlink" title="1.自定义带按钮通知栏(如下样式)"></a>1.自定义带按钮通知栏(如下样式)</h4><p>正在进行的<br>“正在进行的”通知使用户了解正在运行的后台进程。例如，音乐播放器可以显示正在播放的音乐。也可以用来显示需要长时间处理的操作，例如下载或编码视频。“正在进行的”通知不能被手动删除。<br><img src="http://7xl32g.com1.z0.glb.clouddn.com/notifications_pattern_ongoing_music.png"></p>
<p>实现方法如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showButtonNotify</span><span class="params">()</span></span>&#123;</div><div class="line">     NotificationCompat.Builder mBuilder = <span class="keyword">new</span> Builder(<span class="keyword">this</span>);</div><div class="line">     RemoteViews mRemoteViews = <span class="keyword">new</span> RemoteViews(getPackageName(), R.layout.view_custom_button);</div><div class="line">     mRemoteViews.setImageViewResource(R.id.custom_song_icon, R.drawable.sing_icon);</div><div class="line">     <span class="comment">//API3.0 以上的时候显示按钮，否则消失</span></div><div class="line">     mRemoteViews.setTextViewText(R.id.tv_custom_song_singer, <span class="string">"周杰伦"</span>);</div><div class="line">     mRemoteViews.setTextViewText(R.id.tv_custom_song_name, <span class="string">"七里香"</span>);</div><div class="line">     <span class="comment">//如果版本号低于（3。0），那么不显示按钮</span></div><div class="line">     <span class="keyword">if</span>(BaseTools.getSystemVersion() &lt;= <span class="number">9</span>)&#123;</div><div class="line">           mRemoteViews.setViewVisibility(R.id.ll_custom_button, View.GONE);</div><div class="line">     &#125;<span class="keyword">else</span>&#123;</div><div class="line">           mRemoteViews.setViewVisibility(R.id.ll_custom_button, View.VISIBLE);</div><div class="line">     &#125;</div><div class="line">     <span class="comment">//</span></div><div class="line">     <span class="keyword">if</span>(isPlay)&#123;</div><div class="line">           mRemoteViews.setImageViewResource(R.id.btn_custom_play, R.drawable.btn_pause);</div><div class="line">     &#125;<span class="keyword">else</span>&#123;</div><div class="line">           mRemoteViews.setImageViewResource(R.id.btn_custom_play, R.drawable.btn_play);</div><div class="line">     &#125;</div><div class="line">     <span class="comment">//点击的事件处理</span></div><div class="line">     Intent buttonIntent = <span class="keyword">new</span> Intent(ACTION_BUTTON);</div><div class="line">     <span class="comment">/* 上一首按钮 */</span></div><div class="line">     buttonIntent.putExtra(INTENT_BUTTONID_TAG, BUTTON_PREV_ID);</div><div class="line">     <span class="comment">//这里加了广播，所及INTENT的必须用getBroadcast方法</span></div><div class="line">     PendingIntent intent_prev = PendingIntent.getBroadcast(<span class="keyword">this</span>, <span class="number">1</span>, buttonIntent, PendingIntent.FLAG_UPDATE_CURRENT);</div><div class="line">     mRemoteViews.setOnClickPendingIntent(R.id.btn_custom_prev, intent_prev);</div><div class="line">     <span class="comment">/* 播放/暂停  按钮 */</span></div><div class="line">     buttonIntent.putExtra(INTENT_BUTTONID_TAG, BUTTON_PALY_ID);</div><div class="line">     PendingIntent intent_paly = PendingIntent.getBroadcast(<span class="keyword">this</span>, <span class="number">2</span>, buttonIntent, PendingIntent.FLAG_UPDATE_CURRENT);</div><div class="line">     mRemoteViews.setOnClickPendingIntent(R.id.btn_custom_play, intent_paly);</div><div class="line">     <span class="comment">/* 下一首 按钮  */</span></div><div class="line">     buttonIntent.putExtra(INTENT_BUTTONID_TAG, BUTTON_NEXT_ID);</div><div class="line">     PendingIntent intent_next = PendingIntent.getBroadcast(<span class="keyword">this</span>, <span class="number">3</span>, buttonIntent, PendingIntent.FLAG_UPDATE_CURRENT);</div><div class="line">     mRemoteViews.setOnClickPendingIntent(R.id.btn_custom_next, intent_next);</div><div class="line"> </div><div class="line">     mBuilder.setContent(mRemoteViews)</div><div class="line">             .setContentIntent(getDefalutIntent(Notification.FLAG_ONGOING_EVENT))</div><div class="line">             .setWhen(System.currentTimeMillis())<span class="comment">// 通知产生的时间，会在通知信息里显示</span></div><div class="line">             .setTicker(<span class="string">"正在播放"</span>)</div><div class="line">             .setPriority(Notification.PRIORITY_DEFAULT)<span class="comment">// 设置该通知优先级</span></div><div class="line">             .setOngoing(<span class="keyword">true</span>)</div><div class="line">             .setSmallIcon(R.drawable.sing_icon);</div><div class="line">     Notification notify = mBuilder.build();</div><div class="line">     notify.flags = Notification.FLAG_ONGOING_EVENT;</div><div class="line">     mNotificationManager.notify(notifyId, notify);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>注意：带按钮的布局相应点击事件在3.0以下版本没有用，所以这边作了系统版本判断，来显示消失按钮。</p>
<h4 id="2-自定义不带按钮通知栏"><a href="#2-自定义不带按钮通知栏" class="headerlink" title="2.自定义不带按钮通知栏"></a>2.自定义不带按钮通知栏</h4><p>实现方法如下：</p>
<pre><code>//先设定RemoteViews
RemoteViews view_custom = new RemoteViews(getPackageName(), R.layout.view_custom);
//设置对应IMAGEVIEW的ID的资源图片
view_custom.setImageViewResource(R.id.custom_icon, R.drawable.icon);
//view_custom.setInt(R.id.custom_icon,&quot;setBackgroundResource&quot;,R.drawable.icon);
view_custom.setTextViewText(R.id.tv_custom_title, &quot;今日头条&quot;);
view_custom.setTextViewText(R.id.tv_custom_content, &quot;金州勇士官方宣布球队已经解雇了主帅马克-杰克逊&quot;);
</code></pre><p>之后调用：</p>
<pre><code>mBuilder.setContent(view_custom)
</code></pre><p>来设定自定义的这个布局。</p>
<h4 id="最近遇到的代码例子："><a href="#最近遇到的代码例子：" class="headerlink" title="最近遇到的代码例子："></a>最近遇到的代码例子：</h4><pre><code>//final String STATUS_BAR_COVER_CLICK_ACTION=&quot;download&quot;;
    private void showNotification() {

        final NotificationManager mNotificationManager = (NotificationManager) getSystemService(NOTIFICATION_SERVICE);
        NotificationCompat.Builder mBuilder = new NotificationCompat.Builder(this);
        final RemoteViews mRemoteViews = new RemoteViews(getPackageName(), R.layout.layout_notification_custom);


//        Intent buttonIntent=new Intent(this, SendNewsActivity.class);
//        buttonIntent.putExtra(&quot;key&quot;, 1456546);
//        buttonIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);

        mBuilder.setContent(mRemoteViews)
                .setWhen(System.currentTimeMillis())// 通知产生的时间，会在通知信息里显示
                .setPriority(Notification.PRIORITY_DEFAULT)// 设置该通知优先级
                .setSmallIcon(R.drawable.myicon).setAutoCancel(true);

//        BroadcastReceiver onClickReceiver = new BroadcastReceiver() {
//            private boolean flag = false;
//            @Override
//            public void onReceive(Context context, Intent intent) {
//                if (intent.getAction().equals(STATUS_BAR_COVER_CLICK_ACTION)) {
//                 //在这里处理点击事件
//                   ToastUtil.show(&quot;========wobeidianjile&quot;);
//                 //取消通知栏
////                    mNotificationManager.cancel(0);
//                }
//            }};

//        IntentFilter filter = new IntentFilter();
//        filter.addAction(STATUS_BAR_COVER_CLICK_ACTION);
//        registerReceiver(onClickReceiver, filter);
//        Intent buttonIntent = new Intent(STATUS_BAR_COVER_CLICK_ACTION);

        Intent buttonIntent=new Intent();
        buttonIntent.setAction(Intent.ACTION_VIEW);
        buttonIntent.setData(Uri.parse(&quot;http://img.zcool.cn/community/01b28d554bcd6e000001bf72eacf96.jpg&quot;));
        PendingIntent pendingIntent=PendingIntent.getActivity(this,0,buttonIntent,PendingIntent.FLAG_UPDATE_CURRENT);
//        PendingIntent pendingIntent=PendingIntent.getBroadcast(this, 0, buttonIntent, 0);
        mBuilder.setContentIntent(pendingIntent);
//        mRemoteViews.setOnClickPendingIntent(R.id.image,pendingIntent);
        Notification notify = mBuilder.build();
Picasso.with(this).load(bean.getImg()).into(mRemoteViews,R.id.image,0,notify);
        mNotificationManager.notify(0, notify);
    }
</code></pre><p>###Android 5.0之后通知栏图标为白色的解决方案：</p>
<p>####1.<br>Android 5.0(API23)针对targetSdkVersion&gt;=21（Build.VERSION_CODES.LOLLIPOP是21，非23 )， 通知栏图标均自动做了过滤处理，为了统一整个系统的风格。 </p>
<pre><code>if (entry.icon != null) {
            if (entry.targetSdk &gt;= Build.VERSION_CODES.LOLLIPOP) {
                entry.icon.setColorFilter(mContext.getResources().getColor(android.R.color.white));
            } else {
                entry.icon.setColorFilter(null);
            }
        }
</code></pre><p>目前可行的就是把AndroidManifest.xml uses-sdk节点的targetSdkVersion属性设置为21以下（不含21）。</p>
<p>####2.<br>在5.0之前的版本用一个图片，在之后的版本用另一张只有白色和透明的颜色，然后再设置一个背景颜色</p>
<pre><code>if (android.os.Build.VERSION.SDK_INT &lt; 21)                         
     nf.icon = R.drawable.ic_launcher;                     
else {                         
     nf.icon = R.drawable.ic_launcher_notification;                         
     Class&lt;?&gt; clazz = nf.getClass();                         
     Field field = clazz.getDeclaredField(&quot;color&quot;);                         
     field.setAccessible(true);                         
     field.set(nf, context.getResources().getColor(R.color.red_launcher));         
    }
</code></pre><p>###<a href="https://github.com/iosline/Notification" target="_blank" rel="external">知识点示例代码</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/02/24/Android通知详解学习/" itemprop="url">
                  Android通知详解学习
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-02-24T15:05:50+08:00" content="2016-02-24">
              2016-02-24
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Notification状态通知栏：</p>
<p>###功能作用</p>
<ol>
<li>显示接收到短消息、即使消息等信息 （如QQ、微信、新浪、短信）</li>
<li>显示客户端的推送消息（如有新版本发布，广告，推荐新闻等）</li>
<li>显示正在进行的事物（例如：后台运行的程序）（如音乐播放器、版本更新时候的下载进度等）</li>
</ol>
<p>###思维导图结构</p>
<p>Notificaiton — service   – BroadcastReceiver  – Intent（flag、Action等属性应用） —  PendingIntent</p>
<p>###联系：</p>
<ol>
<li><p>由于service 是在后台运行，所以它意图做什么我们看不到，可以通过Notificaiton 来显示提醒（如音乐的后台播放）。</p>
</li>
<li><p>service服务和BroadcastReceiver广播相结合，在加上Notificaiton 显示（如程序的后台更新）。</p>
</li>
<li><p>Intent作为意图处理，和Notificaiton的点击时间紧密结合在了一起，并且与BroadcastReceiver和service的联系也紧密不可以分割。</p>
</li>
</ol>
<p>（service 在后台之后通过BroadcastReceiver来通知Notificaiton 显示相关东西，在通过Intent完成用户的意图操作）</p>
<p>###大体了解</p>
<p>Notification支持文字内容显示、震动、三色灯、铃声等多种提示形式，在默认情况下，Notification仅显示消息标题、消息内容、送达时间这3项内容。以下就是通知的基本布局。</p>
<p>####通知的基本布局：</p>
<p><img src="http://7xl32g.com1.z0.glb.clouddn.com/notifications_pattern_anatomy.png"></p>
<p>####元素：</p>
<ol>
<li><p>标题   Title/Name</p>
</li>
<li><p>大图标  Icon/Photo</p>
</li>
<li><p>内容文字</p>
</li>
<li><p>内容信息   MESSAGE</p>
</li>
<li><p>小图标 Secondary Icon</p>
</li>
<li><p>通知的时间 Timestamp,默认为系统发出通知的时间，也可通过setWhen()来设置</p>
</li>
</ol>
<p>###相关分析：</p>
<p>状态通知栏主要涉及到2个类：  Notification 和 NotificationManager</p>
<p>Notification为通知信息类，它里面对应了通知栏的各个属性</p>
<p>NotificationManager ：  是状态栏通知的管理类，负责发通知、清除通知等操作。</p>
<p>注意：NotificationManager 是一个系统Service，所以必须通过 getSystemService(NOTIFICATION_SERVICE)方法来获取，方法如下。</p>
<pre><code>NotificationManager mNotificationManager = (NotificationManager) getSystemService(NOTIFICATION_SERVICE);
</code></pre><p>###使用步骤：</p>
<p>####流程模块：</p>
<p><li>第一步：创建一个通知栏的Builder构造类  （Create a Notification Builder）</li></p>
<p><li>第二步：定义通知栏的Action  （Define the Notification’s Action）</li></p>
<p><li>第三步：设置通知栏点击事件    （Set the Notification’s Click Behavior）</li></p>
<p><li>第四步：通知   （Issue the Notification）</li></p>
<p>####代码模块：<br>实现系统默认的通知栏效果：</p>
<p><li>第一步：获取状态通知栏管理：</li></p>
<pre><code>NotificationManager mNotificationManager = (NotificationManager) getSystemService(NOTIFICATION_SERVICE);
</code></pre><p><li>第二步：实例化通知栏构造器NotificationCompat.Builder：</li></p>
<pre><code>NotificationCompat.Builder mBuilder = new NotificationCompat.Builder(this);
</code></pre><p><li>第三步：对Builder进行配置：</li></p>
<pre><code>mBuilder.setContentTitle(&quot;测试标题&quot;)//设置通知栏标题
    .setContentText(&quot;测试内容&quot;) //设置通知栏显示内容
    .setContentIntent(getDefalutIntent(Notification.FLAG_AUTO_CANCEL)) //设置通知栏点击意图
    //  .setNumber(number) //设置通知集合的数量
    .setTicker(&quot;测试通知来啦&quot;) //通知首次出现在通知栏，带上升动画效果的
    .setWhen(System.currentTimeMillis())//通知产生的时间，会在通知信息里显示，一般是系统获取到的时间
    .setPriority(Notification.PRIORITY_DEFAULT) //设置该通知优先级
    //  .setAutoCancel(true)//设置这个标志当用户单击面板就可以让通知将自动取消
    .setOngoing(false)//true，设置他为一个正在进行的通知。他们通常是用来表示一个后台任务,用户积极参与(如播放音乐)或以某种方式正在等待,因此占用设备(如一个文件下载,同步操作,主动网络连接)
    .setDefaults(Notification.DEFAULT_VIBRATE)//向通知添加声音、闪灯和振动效果的最简单、最一致的方式是使用当前的用户默认设置，使用defaults属性，可以组合
    //Notification.DEFAULT_ALL  Notification.DEFAULT_SOUND 添加声音 // requires VIBRATE permission
    .setSmallIcon(R.drawable.ic_launcher);//设置通知小ICON
</code></pre><p><li>第四步：设置通知栏PendingIntent（点击动作事件等都包含在这里）</li></p>
<pre><code>mBuilder.setContentIntent(PendingIntent intent)
</code></pre><p>PendingIntent和Intent略有不同，它可以设置执行次数，主要用于远程服务通信、闹铃、通知、启动器、短信中，在一般情况下用的比较少。</p>
<p>相关属性和方法</p>
<p>属性：</p>
<pre><code>PendingIntent的位标识符：
FLAG_ONE_SHOT   表示返回的PendingIntent仅能执行一次，执行完后自动取消
FLAG_NO_CREATE     表示如果描述的PendingIntent不存在，并不创建相应的PendingIntent，而是返回NULL
FLAG_CANCEL_CURRENT      表示相应的PendingIntent已经存在，则取消前者，然后创建新的PendingIntent，这个有利于数据保持为最新的，可以用于即时通信的通信场景
FLAG_UPDATE_CURRENT     表示更新的PendingIntent
</code></pre><p>方法：<br><img src="http://7xl32g.com1.z0.glb.clouddn.com/20140511193432625.jpg"><br>可以看出，它支持多种相应方式，有Activity、Broadcast、Service，就根据你自身需求去选择。</p>
<p>在各种情况下情况下它还会根据各种情况出发效果：</p>
<pre><code>contentIntent：在通知窗口区域，Notification被单击时的响应事件由该intent触发；
deleteIntent：当用户点击全部清除按钮时，响应该清除事件的Intent；
fullScreenIntent：响应紧急状态的全屏事件（例如来电事件），也就是说通知来的时候，跳过在通知区域点击通知这一步，直接执行fullScreenIntent代表的事件。
</code></pre><p>例如：在执行了点击通知之后要跳转到指定的XXX的Activity的时候，可以设置以下方法来相应点击事件：</p>
<pre><code>Intent intent = new Intent(context,XXX.class);
PendingIntent pendingIntent = PendingIntent.getActivity(context, 0, intent, 0);
mBuilder.setContentIntent(pendingIntent)
</code></pre><p>例如：在执行了清空全部的通知操作时候，可以设置以下方法来相应这个事件：</p>
<p>采用setDeleteIntent(PendingIntent intent)方法或按照以下写法</p>
<pre><code>Intent deleteIntent = new Intent();
deleteIntent.setClass(context, XXXReceiver.class);
deleteIntent.setAction(DELETE_ACTION);
notification.deleteIntent = PendingIntent.getBroadcast(context, 0, deleteIntent, 0);
</code></pre><p>例如：在响应紧急事件（如来电）时候，可以设置以下方法来相应这个事件：</p>
<pre><code>setFullScreenIntent(PendingIntent intent, boolean highPriority)
</code></pre><p><li>第五步，最简单的一部，发送通知请求</li></p>
<pre><code>mNotificationManager.notify(notifyId, mBuilder.build());
</code></pre><p>####对应的各个方法的属性（部分方法以上代码中已经作注释，就不再介绍）：</p>
<p>#####（1）方法：设置提醒标志符Flags<br>功能：提醒标志符，向通知添加声音、闪灯和振动效果等设置达到通知提醒效果，可以组合多个属性</p>
<p>有2种设置方法：</p>
<p>1.实例化通知栏之后通过给他添加.flags属性赋值。</p>
<pre><code>Notification notification = mBuilder.build();
notification.flags = Notification.FLAG_AUTO_CANCEL;
</code></pre><p>2.通过setContentIntent(PendingIntent intent)方法中的意图设置对应的flags</p>
<pre><code>public PendingIntent getDefalutIntent(int flags){
      PendingIntent pendingIntent= PendingIntent.getActivity(this, 1, new Intent(), flags);
      return pendingIntent;
}
</code></pre><p>提醒标志符成员：</p>
<pre><code>Notification.FLAG_SHOW_LIGHTS              //三色灯提醒，在使用三色灯提醒时候必须加该标志符
Notification.FLAG_ONGOING_EVENT          //发起正在运行事件（活动中）
Notification.FLAG_INSISTENT   //让声音、振动无限循环，直到用户响应 （取消或者打开）
Notification.FLAG_ONLY_ALERT_ONCE  //发起Notification后，铃声和震动均只执行一次
Notification.FLAG_AUTO_CANCEL      //用户单击通知后自动消失
Notification.FLAG_NO_CLEAR          //只有全部清除时，Notification才会清除 ，不清楚该通知(QQ的通知无法清除，就是用的这个)
Notification.FLAG_FOREGROUND_SERVICE    //表示正在运行的服务
</code></pre><p>#####（2）方法：.setDefaults(int defaults)     （NotificationCompat.Builder中的方法，用于提示）</p>
<p>功能：向通知添加声音、闪灯和振动效果的最简单、使用默认（defaults）属性，可以组合多个属性（和方法1中提示效果一样的）<br>对应属性：</p>
<pre><code>Notification.DEFAULT_VIBRATE    //添加默认震动提醒  需要 VIBRATE permission
Notification.DEFAULT_SOUND    // 添加默认声音提醒
Notification.DEFAULT_LIGHTS// 添加默认三色灯提醒
Notification.DEFAULT_ALL// 添加默认以上3种全部提醒
</code></pre><p>#####（3）方法：setVibrate(long[] pattern)</p>
<p>功能：设置震动方式。<br>使用：</p>
<pre><code>mBuilder.setVibrate(new long[] {0,300,500,700});
</code></pre><p>实现效果：延迟0ms，然后振动300ms，在延迟500ms，接着在振动700ms。</p>
<p>以上方法的还有种写法是</p>
<pre><code>mBuilder.build().vibrate = new long[] {0,300,500,700};
</code></pre><p>以此类推，2种写法都可以。</p>
<p>如果希望设置默认振动方式，设置了方法（2）中默认为DEFAULT_VIBRATE 即可。</p>
<p>#####（4）方法：.setLights(intledARGB ,intledOnMS ,intledOffMS )</p>
<p>功能：android支持三色灯提醒，这个方法就是设置不同场景下的不同颜色的灯。<br>描述：其中ledARGB 表示灯光颜色、 ledOnMS 亮持续时间、ledOffMS 暗的时间。<br>注意：</p>
<p>1）只有在设置了标志符Flags为Notification.FLAG_SHOW_LIGHTS的时候，才支持三色灯提醒。<br>2）这边的颜色跟设备有关，不是所有的颜色都可以，要看具体设备。<br>使用：</p>
<pre><code>mBuilder.setLights(0xff0000ff, 300, 0)
</code></pre><p>同理，以下方法也可以设置同样效果：</p>
<pre><code>Notification notify = mBuilder.build();
notify.flags = Notification.FLAG_SHOW_LIGHTS;
notify.ledARGB = 0xff0000ff;
notify.ledOnMS = 300;
notify.ledOffMS = 300;
</code></pre><p>如果希望使用默认的三色灯提醒，设置了方法（2）中默认为DEFAULT_LIGHTS即可。</p>
<p>#####（5）方法：.setSound(Uri sound)</p>
<p>功能：设置默认或则自定义的铃声，来提醒。</p>
<pre><code>//获取默认铃声
.setDefaults(Notification.DEFAULT_SOUND)
//获取自定义铃声
.setSound(Uri.parse(&quot;file:///sdcard/xx/xx.mp3&quot;))
//获取Android多媒体库内的铃声
.setSound(Uri.withAppendedPath(Audio.Media.INTERNAL_CONTENT_URI, &quot;5&quot;))
</code></pre><p>同理相同效果的另一种设置方法这边就不讲， 和上面的都是一样的。</p>
<p>#####（6）方法：.setPriority(int pri)</p>
<p>功能：设置优先级</p>
<p>对应属性：</p>
<pre><code>Notification.PRIORITY_DEFAULT
Notification.PRIORITY_HIGH
Notification.PRIORITY_LOW
Notification.PRIORITY_MAX
Notification.PRIORITY_MIN
</code></pre><p>#####（7）方法：setOngoing(boolean ongoing)</p>
<p>功能：设置为ture，表示它为一个正在进行的通知。他们通常是用来表示一个后台任务,用户积极参与(如播放音乐)或以某种方式正在等待,因此占用设备(如一个文件下载,同步操作,主动网络连接)</p>
<p>#####（8）方法：setProgress(int max, int progress,boolean indeterminate)</p>
<p>属性：max:进度条最大数值  、progress:当前进度、indeterminate:表示进度是否不确定，true为不确定，false为确定</p>
<p>功能：设置带进度条的通知，可以在下载中使用</p>
<p>注意：此方法在4.0及以后版本才有用，如果为早期版本：需要自定义通知布局，其中包含ProgressBar视图</p>
<p>使用：如果为确定的进度条：调用setProgress(max, progress, false)来设置通知，在更新进度的时候在此发起通知更新progress，并且在下载完成后要移除进度条，通过调用setProgress(0, 0, false)既可。</p>
<p>如果为不确定（持续活动）的进度条，这是在处理进度无法准确获知时显示活动正在持续，所以调用setProgress(0, 0, true) ，操作结束时，调用setProgress(0, 0, false)并更新通知以移除指示条</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/02/17/自定义ViewPager实现无限轮播/" itemprop="url">
                  自定义ViewPager实现无限轮播
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-02-17T14:41:05+08:00" content="2016-02-17">
              2016-02-17
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ViewPager实现的轮播图广告自定义视图，如京东首页的广告轮播图效果；<br>既支持自动轮播页面也支持手势滑动切换页面</p>
<p><b>CustomViewPager.java</b></p>
<pre><code>public class CustomViewPager extends FrameLayout {

    //自动轮播的时间间隔
    private final static int TIME_INTERVAL = 5;

    //放轮播图片的ImageView 的list
    private List&lt;ImageView&gt; imageViewsList;

    private List&lt;LunbotuBean&gt; newsList;

    private ViewPager viewPager;
    private TextView title;
    private LinearLayout pointGroup;
    //当前轮播页
    private int currentItem = 0;
    //定时任务
    private ScheduledExecutorService scheduledExecutorService;
    //Handler
    private Handler handler = new Handler() {

        @Override
        public void handleMessage(Message msg) {
            super.handleMessage(msg);
            viewPager.setCurrentItem(currentItem);
        }

    };

    public CustomViewPager(Context context) {
        this(context, null);
    }

    public CustomViewPager(Context context, AttributeSet attrs) {
        this(context, attrs, 0);
    }

    public CustomViewPager(Context context, AttributeSet attrs, int defStyle) {
        super(context, attrs, defStyle);

    }

    public void setData(List&lt;LunbotuBean&gt; newsList, boolean isAutoPlay) {
        this.newsList = newsList;
        initView();
        initData();
        if (isAutoPlay) {
            startPlay();
        }
    }

    /**
     * 开始轮播图切换
     */
    private void startPlay() {
        scheduledExecutorService = Executors.newSingleThreadScheduledExecutor();
        scheduledExecutorService.scheduleAtFixedRate(new SlideShowTask(), 5, 4, TimeUnit.SECONDS);
    }

    /**
     * 停止轮播图切换
     */
    private void stopPlay() {
        scheduledExecutorService.shutdown();
    }

    @Override
    protected void onDetachedFromWindow() {
        super.onDetachedFromWindow();
    }

    /**
     * 初始化Views等UI
     */
    private void initData() {
        imageViewsList = new ArrayList&lt;&gt;();
        title.setText(newsList.get(0).getTitle());

        for (int i = 0; i &lt; newsList.size(); i++) {
            ImageView view = new ImageView(getContext());
            final LunbotuBean bean = newsList.get(i);
            final int finalI = i;
            Ion.with(view).placeholder(R.drawable.img_options_wait_list).load(bean.getImage());
            view.setScaleType(ScaleType.CENTER_CROP);
            view.setOnClickListener(new OnClickListener() {
                @Override
                public void onClick(View v) {
                    String[] arr = new String[newsList.size() - finalI];
                    String[] images = new String[newsList.size() - finalI];
                    for (int j = 0; j &lt; newsList.size(); j++) {
                        if (j &gt;= finalI) {
                            arr[j - finalI] = newsList.get(j).getId();
                            images[j - finalI] = newsList.get(j).getImage();
                        }
                    }
                    NoteActivity_.intent(getContext()).array(arr).titleImages(images).start();
                }
            });
            imageViewsList.add(view);

            ImageView point = new ImageView(getContext());
            point.setBackgroundResource(R.drawable.point_bg);
            if (i == 0) {
                point.setEnabled(true);
            } else {
                point.setEnabled(false);
            }
            LinearLayout.LayoutParams layoutParams = new LinearLayout.LayoutParams(LinearLayout.LayoutParams.WRAP_CONTENT, -2);
            layoutParams.leftMargin = 10;
            pointGroup.addView(point, layoutParams);
        }


        viewPager = (ViewPager) findViewById(R.id.viewPager);
        viewPager.setFocusable(true);

        viewPager.setAdapter(new CustomPagerAdapter(imageViewsList));
        viewPager.setOnPageChangeListener(new MyPageChangeListener());
    }

    private void initView() {
        LayoutInflater.from(getContext()).inflate(R.layout.layout_custom_viewpager, this, true);
        viewPager = (ViewPager) findViewById(R.id.viewPager);
        title = (TextView) findViewById(R.id.lunbo_title);
        pointGroup = (LinearLayout) findViewById(R.id.ll_point_container);

    }

    private int lastPosition;


    /**
     * ViewPager的监听器
     * 当ViewPager中页面的状态发生改变时调用
     *
     * @author caizhiming
     */
    private class MyPageChangeListener implements OnPageChangeListener {

        boolean isAutoPlay = false;

        @Override
        public void onPageScrollStateChanged(int arg0) {
            switch (arg0) {
                case 1:// 手势滑动，空闲中
                    isAutoPlay = false;
                    break;
                case 2:// 界面切换中
                    isAutoPlay = true;
                    break;
                case 0:// 滑动结束，即切换完毕或者加载完毕
                    // 当前为最后一张，此时从右向左滑，则切换到第一张
                    if (viewPager.getCurrentItem() == viewPager.getAdapter().getCount() - 1 &amp;&amp; !isAutoPlay) {
                        viewPager.setCurrentItem(0);
                    }
                    // 当前为第一张，此时从左向右滑，则切换到最后一张
                    else if (viewPager.getCurrentItem() == 0 &amp;&amp; !isAutoPlay) {
                        viewPager.setCurrentItem(viewPager.getAdapter().getCount() - 1);
                    }
                    break;
            }
        }

        @Override
        public void onPageScrolled(int arg0, float arg1, int arg2) {
            // TODO Auto-generated method stub

        }

        @Override
        public void onPageSelected(int pos) {
            title.setText(newsList.get(pos).getTitle());
            pointGroup.getChildAt(lastPosition).setEnabled(false);
            pointGroup.getChildAt(pos).setEnabled(true);
            lastPosition = pos;

        }

    }

    /**
     * 执行轮播图切换任务
     *
     * @author caizhiming
     */
    private class SlideShowTask implements Runnable {

        @Override
        public void run() {
            synchronized (viewPager) {
                currentItem = (currentItem + 1) % imageViewsList.size();
                handler.obtainMessage().sendToTarget();
            }
        }

    }

    /**
     * 销毁ImageView资源，回收内存
     *
     * @author caizhiming
     */
    private void destoryBitmaps() {

        for (int i = 0; i &lt; imageViewsList.size(); i++) {
            ImageView imageView = imageViewsList.get(i);
            Drawable drawable = imageView.getDrawable();
            if (drawable != null) {
                //解除drawable对view的引用
                drawable.setCallback(null);
            }
        }
    }

}
</code></pre><p><b>布局文件</b></p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;
    android:orientation=&quot;vertical&quot;&gt;

    &lt;android.support.v4.view.ViewPager
        android:id=&quot;@+id/viewPager&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;150dp&quot; /&gt;

    &lt;RelativeLayout
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:padding=&quot;5dp&quot;&gt;

        &lt;TextView
            android:id=&quot;@+id/lunbo_title&quot;
            android:layout_width=&quot;match_parent&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:layout_toLeftOf=&quot;@+id/ll_point_container&quot;
            android:singleLine=&quot;true&quot;
            android:textColor=&quot;@color/black&quot;
            android:textSize=&quot;16sp&quot;
            /&gt;

        &lt;LinearLayout
            android:id=&quot;@+id/ll_point_container&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:layout_alignParentRight=&quot;true&quot;
            android:layout_centerVertical=&quot;true&quot;
            android:orientation=&quot;horizontal&quot; /&gt;
    &lt;/RelativeLayout&gt;
&lt;/LinearLayout&gt;
</code></pre><p><b>CustomPagerAdapter.java</b></p>
<pre><code>public class CustomPagerAdapter extends PagerAdapter{

    public List&lt;ImageView&gt; imageViewList;
    public CustomPagerAdapter(List&lt;ImageView&gt; imageViewsList){
       this.imageViewList=imageViewsList;
    }
    @Override
    public void destroyItem(View container, int position, Object object) {
        ((ViewPager)container).removeView(imageViewList.get(position));
    }

    @Override
    public boolean isViewFromObject(View view, Object object) {
        return view == object;
    }

    @Override
    public Object instantiateItem(View container, int position) {
        ((ViewPager)container).addView(imageViewList.get(position));
        return imageViewList.get(position);
    }

    @Override
    public int getCount() {
        return imageViewList.size();
    }
}
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/02/16/EventBus使用详解/" itemprop="url">
                  EventBus使用详解
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-02-16T17:26:41+08:00" content="2016-02-16">
              2016-02-16
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>###一、概述<br>EventBus是一款针对Android优化的发布/订阅事件总线。</p>
<p>主要功能是替代Intent、Handler、BroadCast在Fragment、Activity、Service、线程之间传递消息。</p>
<p>优点是，开销小，代码更优雅，以及将发送者和接受者解耦。</p>
<p>作为一个消息总线，有三个主要的元素：</p>
<p><li>Event：事件</li></p>
<pre><code>Event 可以是任意类型的对象
</code></pre><p><li>Subscriber:事件订阅者，接收特定的事件</li></p>
<p>   在EventBus中，使用约定来指定事件订阅者以简化使用。即所有事件订阅都都是以onEvent开头的函数，具体来说，函数的名字是onEvent，onEventMainThread，onEventBackgroundThread，onEventAsync这四个，这个和ThreadMode有关</p>
<p><li>Publisher:事件发布者，用于通知Subscriber有事件发生</li></p>
<p>可以在任意线程任意位置发送事件，直接调用EventBus的<code>post(Object)</code>方法，可以自己实例化EventBus对象，但一般使用默认的单例就好了：<code>EventBus.getDefault()</code>，根据post函数参数的类型，会自动调用订阅相应类型事件的函数。</p>
<p><li>ThreadMode</li></p>
<p>前面说了，Subscriber函数的名字只能是那4个，因为每个事件订阅函数都是和一个<code>ThreadMode</code>相关联的，ThreadMode指定了会调用的函数。有以下四个ThreadMode：</p>
<ul><li>PostThread：事件的处理在和事件的发送在相同的进程，所以事件处理时间不应太长，不然影响事件的发送线程，而这个线程可能是UI线程。对应的函数名是onEvent。<br><br></li><li>MainThread: 事件的处理会在UI线程中执行。事件处理时间不能太长，这个不用说的，长了会ANR的，对应的函数名是onEventMainThread。<br><br></li><li>BackgroundThread：事件的处理会在一个后台线程中执行，对应的函数名是onEventBackgroundThread，虽然名字是BackgroundThread，事件处理是在后台线程，但事件处理时间还是不应该太长，因为如果发送事件的线程是后台线程，会直接执行事件，如果当前线程是UI线程，事件会被加到一个队列中，由一个线程依次处理这些事件，如果某个事件处理时间太长，会阻塞后面的事件的派发或处理。<br><br></li><li>Async：事件处理会在单独的线程中执行，主要用于在后台线程中执行耗时操作，每个事件会开启一个线程（有线程池），但最好限制线程的数目。</li></ul>

<p>根据事件订阅都函数名称的不同，会使用不同的ThreadMode，比如果在后台线程加载了数据想在UI线程显示，订阅者只需把函数命名为onEventMainThread。</p>
<p>###二、基本使用</p>
<p>导入：</p>
<pre><code>compile &apos;de.greenrobot:eventbus:2.4.0&apos;
</code></pre><p>使用方法：</p>
<p>在EventBus中，获取实例的方法一般是采用EventBus.getInstance()来获取默认的EventBus实例</p>
<p>①.定义事件类型：<br><code>public class MyEvent {}</code></p>
<p>②.定义事件处理方法：<br><code>public void onEventMainThread</code></p>
<p>③.注册订阅者：<br><code>EventBus.getDefault().register(this)</code></p>
<p>③.解除注册订阅者：<br><code>EventBus.getDefault().unregister(this)</code></p>
<p>④.发送事件：<br><code>EventBus.getDefault().post(new MyEvent())</code></p>
<p>注册/解除订阅者，是在对事件进行处理的Activity或者Fragment等的onCreate()、onDestoty()中进行的。<br>发送事件的页面中不用注册。</p>
<p>###三、实战</p>
<p>现在我们的需求是这样的，两个Fragment组成主界面，左边的Fragment是个目录、即列表，右边的Fragment是详细信息面板；</p>
<p>a、目录的列表是从网络获取的。</p>
<p>b、当点击目录上的条目时，动态更新详细信息面板；</p>
<p>效果图：</p>
<p><img src="http://7xl32g.com1.z0.glb.clouddn.com/greendao.gif"></p>
<p>有了这个需求，我们传统的做法是：</p>
<p>a、目录Fragment在onCreate中去开启线程去访问网络获取数据，获取完成以后，通过handler去更新界面。</p>
<p>b、在目录的Fragment中提供一个接口，然后详细信息面板去注册这个接口，当发生点击时，去回调这个接口，让详细信息面板发生改变。</p>
<p>这种做法不错的，但是有了EventBus之后，我们有….</p>
<p>####1.MainActivity及其布局</p>
<pre><code>public class MainActivity extends FragmentActivity  
{  
    @Override  
    protected void onCreate(Bundle savedInstanceState)  
    {  
        super.onCreate(savedInstanceState);  
        setContentView(R.layout.activity_main);  
    }  

}  
</code></pre><p>布局</p>
<pre><code>&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;  
    xmlns:tools=&quot;http://schemas.android.com/tools&quot;  
    android:layout_width=&quot;match_parent&quot;  
    android:layout_height=&quot;match_parent&quot;  
    android:baselineAligned=&quot;false&quot;  
    android:divider=&quot;?android:attr/dividerHorizontal&quot;  
    android:orientation=&quot;horizontal&quot;  
    android:showDividers=&quot;middle&quot; &gt;  

    &lt;fragment  
        android:id=&quot;@+id/item_list&quot;  
        android:name=&quot;com.angeldevil.eventbusdemo.ItemListFragment&quot;  
        android:layout_width=&quot;0dip&quot;  
        android:layout_height=&quot;match_parent&quot;  
        android:layout_weight=&quot;1&quot; /&gt;  

    &lt;fragment  
        android:id=&quot;@+id/item_detail_container&quot;  
        android:name=&quot;com.angeldevil.eventbusdemo.ItemDetailFragment&quot;  
        android:layout_width=&quot;0dip&quot;  
        android:layout_height=&quot;match_parent&quot;  
        android:layout_weight=&quot;2&quot; /&gt;  

&lt;/LinearLayout&gt;  
</code></pre><p>可以看到，我们MainActvity可以说没有一行代码，布局文件即两个Fragment组成；</p>
<p>####2.ItemListFragment<br>首先看个实体类</p>
<pre><code>public class Item  
{  
    public String id;  
    public String content;  

    public static List&lt;Item&gt; ITEMS = new ArrayList&lt;Item&gt;();  
    static  
    {  
        // Add 6 sample items.  
        addItem(new Item(&quot;1&quot;, &quot;Item 1&quot;));  
        addItem(new Item(&quot;2&quot;, &quot;Item 2&quot;));  
        addItem(new Item(&quot;3&quot;, &quot;Item 3&quot;));  
        addItem(new Item(&quot;4&quot;, &quot;Item 4&quot;));  
        addItem(new Item(&quot;5&quot;, &quot;Item 5&quot;));  
        addItem(new Item(&quot;6&quot;, &quot;Item 6&quot;));  
    }  

    private static void addItem(Item item)  
    {  
        ITEMS.add(item);  
    }  

    public Item(String id, String content)  
    {  
        this.id = id;  
        this.content = content;  
    }  

    @Override  
    public String toString()  
    {  
        return content;  
    }  
}  
</code></pre><p>其次，ItemListFragment</p>
<pre><code>public class ItemListFragment extends ListFragment  
{  

    @Override  
    public void onCreate(Bundle savedInstanceState)  
    {  
        super.onCreate(savedInstanceState);  
        // Register  
        EventBus.getDefault().register(this);  
    }  

    @Override  
    public void onDestroy()  
    {  
        super.onDestroy();  
        // Unregister  
        EventBus.getDefault().unregister(this);  
    }  

    @Override  
    public void onViewCreated(View view, Bundle savedInstanceState)  
    {  
        super.onViewCreated(view, savedInstanceState);  
        // 开启线程加载列表  
        new Thread()  
        {  
            public void run()  
            {  
                try  
                {  
                    Thread.sleep(2000); // 模拟延时  
                    // 发布事件，在后台线程发的事件  
                    EventBus.getDefault().post(new ItemListEvent(Item.ITEMS));  
                } catch (InterruptedException e)  
                {  
                    e.printStackTrace();  
                }  
            };  
        }.start();  
    }  

    public void onEventMainThread(ItemListEvent event)  
    {  
        setListAdapter(new ArrayAdapter&lt;Item&gt;(getActivity(),  
                android.R.layout.simple_list_item_activated_1,  
                android.R.id.text1, event.getItems()));  
    }  

    @Override  
    public void onListItemClick(ListView listView, View view, int position,  
            long id)  
    {  
        super.onListItemClick(listView, view, position, id);  
        EventBus.getDefault().post(getListView().getItemAtPosition(position));  
    }  

}  
</code></pre><p>ItemListFragment里面在onCreate里面进行了事件的订阅，onDestroy里面进行了事件的取消；onViewCreated中我们模拟了一个子线程去网络加载数据，获取成功后我们调用<br>了EventBus.getDefault().post(new ItemListEvent(Item.ITEMS));发布了一个事件；</p>
<p>onListItemClick则是ListView的点击事件，我们调用了EventBus.getDefault().post(getListView().getItemAtPosition(position));去发布一个事件，</p>
<p>getListView().getItemAtPosition(position)的类型为Item类型；</p>
<p>细心的你一定发现了一些诡异的事，直接new Thread()获取到数据以后，竟然没有使用handler；我们界面竟然发生了变化，那么List是何时绑定的数据？</p>
<p>仔细看下代码，发现这个方法：</p>
<pre><code>public void onEventMainThread(ItemListEvent event)
    {
        setListAdapter(new ArrayAdapter&lt;Item&gt;(getActivity(),
                android.R.layout.simple_list_item_activated_1,
                android.R.id.text1, event.getItems()));
    }
</code></pre><p>应该是这个方法为List绑定的数据。那么这个方法是怎么被调用的呢？<br>现在就可以细谈订阅事件与发布事件了：</p>
<p>如果方法名以onEvent开头，则代表要订阅一个事件，MainThread意思，这个方法最终要在UI线程执行；当事件发布的时候，这个方法就会被执行。<br>那么这个事件什么时候发布呢？</p>
<p>我们的onEventMainThread触发时机应该在new Thread()执行完成之后，可以看到子线程执行完成之后，执行了EventBus.getDefault().post(new ItemListEvent(Item.ITEMS));</p>
<p>意味着发布了一个事件，当这个事件发布，我们的onEventMainThread就执行了，那么二者的关联关系是什么呢？</p>
<p>其实和参数的类型，我们onEventMainThread需要接收一个ItemListEvent ，我们也发布了一个ItemListEvent的实例。</p>
<p>现在我们完整的理一下：</p>
<p>在onCreate里面执行    EventBus.getDefault().register(this);意思是让EventBus扫描当前类，把所有onEvent开头的方法记录下来，如何记录呢？使用Map，Key为方法的参数类型，Value中包含我们的方法。<br>这样在onCreate执行完成以后，我们的onEventMainThread就已经以键值对的方式被存储到EventBus中了。</p>
<p>然后当子线程执行完毕，调用EventBus.getDefault().post(new ItemListEvent(Item.ITEMS))时，EventBus会根据post中实参的类型，去Map中查找对于的方法，于是找到了我们的onEventMainThread，最终调用反射去执行我们的方法。</p>
<p>现在应该明白了，整个运行的流程了；那么没有接口却能发生回调应该也能解释了。</p>
<p>现在我们在看看代码，当Item点击的时候EventBus.getDefault().post(getListView().getItemAtPosition(position));我们同样发布了一个事件，参数为Item；这个事件是为了让详细信息的Fragment去更新数据，不用说，按照上面的推测，详细信息的Fragment里面一个有个这样的方法：    public void onEventMainThread(Item item) ； 是不是呢？我们去看看。</p>
<p>####3.ItemDetailFragment</p>
<pre><code>public class ItemDetailFragment extends Fragment  
{  

    private TextView tvDetail;  

    @Override  
    public void onCreate(Bundle savedInstanceState)  
    {  
        super.onCreate(savedInstanceState);  
        // register  
        EventBus.getDefault().register(this);  
    }  

    @Override  
    public void onDestroy()  
    {  
        super.onDestroy();  
        // Unregister  
        EventBus.getDefault().unregister(this);  
    }  

    /** List点击时会发送些事件，接收到事件后更新详情 */  
    public void onEventMainThread(Item item)  
    {  
        if (item != null)  
            tvDetail.setText(item.content);  
    }  

    @Override  
    public View onCreateView(LayoutInflater inflater, ViewGroup container,  
            Bundle savedInstanceState)  
    {  
        View rootView = inflater.inflate(R.layout.fragment_item_detail,  
                container, false);  
        tvDetail = (TextView) rootView.findViewById(R.id.item_detail);  
        return rootView;  
    }  
}  
</code></pre><p>果然不出我们的所料，真的存在onEventMainThread(Item item)的方法。当然了，必须在onCreate里面首先书写EventBus.getDefault().register(this);让EventBus扫描再说。</p>
<p>那么这个Fragment的流程就是：onCreate时，EventBus扫描当前类，将onEventMainThread以键值对的形式进行存储，键为Item.class ，值为包含该方法的对象。</p>
<p>然后当ItemListFragment中Item被点击时，发布了一个事件：EventBus.getDefault().post(getListView().getItemAtPosition(position));实参的类型恰好是Item，于是触发我们的<br>onEventMainThread方法，并把Item实参传递进来，我们更新控件。</p>
<p>####4.Event</p>
<pre><code>public class Event  
{  
    /** 列表加载事件 */  
    public static class ItemListEvent  
    {  
        private List&lt;Item&gt; items;  

        public ItemListEvent(List&lt;Item&gt; items)  
        {  
            this.items = items;  
        }  

        public List&lt;Item&gt; getItems()  
        {  
            return items;  
        }  
    }  

}  
</code></pre><p>这个Event 可以是任意类型 可以是个类，还可以是个枚举等，只要参数不同，针对参数的事件做相应的处理。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/01/18/Android-Listview列表中视频的播放与暂停及之间的牵制/" itemprop="url">
                  Android Listview列表中视频的播放与暂停及之间的牵制
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-01-18T17:25:20+08:00" content="2016-01-18">
              2016-01-18
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>实现的效果：</p>
<p>   在列表中播放视频，同时播放这个视频的同时，打开列表中另一个视频，当前视频停止播放,控制视频的进度。</p>
<p>实现方式：</p>
<p>   android原生的videoview及系统的mediaControll，自带的进度条会在当前页面的下方，不能达到我们每个视频一个进度条的效果， 还有进度条位置的效果。</p>
<p>解决：</p>
<p>  自定义视频播放组件，就是将videoview和seekbar整合到一个组件中，自己控制进度，不使用系统的mediaControll。</p>
<p>思路：</p>
<p> 检查 定时器任务是否继续进行，定时器任务（videoview播放进度 控制seekbar的进度），定时器任务关掉，否则会一直进行，退出的时候会崩溃</p>
<p>没写完，回来了解透彻之后在写。</p>
<p>具体代码见：<a href="https://github.com/iosline/videoplayer" target="_blank" rel="external">源码地址</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/12/17/Android中WebView使用之二（JavaScript代码使用）/" itemprop="url">
                  Android中WebView使用之二（JavaScript代码使用）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-12-17T17:11:55+08:00" content="2015-12-17">
              2015-12-17
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>###本文主要讲的是 JS代码与Android代码的互相调用</p>
<p>####一、在WebView中使用JavaScript<br>如果你想要载入的页面中用了JavaScript，你必须为你的WebView使用JavaScript。</p>
<p>一旦使用之后，你也可以自己创建接口在你的应用和JavaScript代码间进行交互。</p>
<p>#####前情提要：使用JavaScript</p>
<p>上一篇文章已经说过，可以通过getSettings()获得WebSettings，然后用setJavaScriptEnabled()使能JavaScript：</p>
<pre><code>WebView myWebView = (WebView) findViewById(R.id.webview);
WebSettings webSettings = myWebView.getSettings();
webSettings.setJavaScriptEnabled(true);
</code></pre><p>#####绑定JavaScript与Android代码</p>
<p>当你为你的Android应用中的WebView专门开发一个网页应用时，你可以创建你的JavaScript代码和你的客户端的Android代码之间的接口。</p>
<p>比如，你可以用JavaScript代码调用Android代码中的方法，来展现一个对话框之类，而不是使用alert()方法（JS中的对话框方法）。</p>
<p>在JS和Android代码间绑定一个新的接口，需要调用 addJavascriptInterface()方法。</p>
<p>方法参数传入一个Java对象实例和一个字符串，该字符串是一个名字（interface name，注意此接口不是通常所说的那个用来实现的接口，而是传入的这个对象在JS中的别名），在JS代码中用此名字调用该Java对象的方法。</p>
<p>注意这个方法可以让JS代码控制宿主程序，这是一个非常有力的特性，但是同时也存在一些安全问题，因为进一步JS代码可以通过反射访问到注入对象的公有域。攻击者可能会在HTML和JavaScript中包含了有威胁性的代码。</p>
<p>所以Android 4.1，API 17，也就是JELLY_BEAN 开始，只有被JavascriptInterface 注解标识的公有方法可以被JS代码访问。</p>
<p>另外，因为JS代码和Java对象在这个WebView所私有的后台线程交互，所以还需要注意线程安全性问题。</p>
<p>注意，与JS代码绑定的的这个Java对象运行在另一个线程中，与创建它的线程不是一个线程。</p>
<p>注意，这个Java对象的域是不可访问的。</p>
<p>#####绑定JavaScript与Android代码的例子</p>
<p>比如可以定义这么一个类：</p>
<pre><code>/**
 * 自定义的Android代码和JavaScript代码之间的桥梁类
 * 
 * @author 1
 * 
 */
public class WebAppInterface
{
    Context mContext;

    /** Instantiate the interface and set the context */
    WebAppInterface(Context c)
    {
        mContext = c;
    }

    /** Show a toast from the web page */
    // 如果target 大于等于API 17，则需要加上如下注解
    // @JavascriptInterface
    public void showToast(String toast)
    {
        // Toast.makeText(mContext, toast, Toast.LENGTH_SHORT).show();
        Toast.makeText(mContext, toast, Toast.LENGTH_LONG).show();
    }
}
</code></pre><p>然后将这个类和你的WebView中的JS代码绑定：</p>
<pre><code>WebView webView = (WebView) findViewById(R.id.webview);
webView.addJavascriptInterface(new WebAppInterface(this), &quot;Android&quot;);
</code></pre><p>　　给这个对象起的别名叫“Android”。</p>
<p>　　这个就创立了一个接口名，叫“Android”，运行在WebView中的JS代码可以通过这个名字调用WebAppInterface类中的showToast()方法：</p>
<pre><code>&lt;input type=&quot;button&quot; value=&quot;Say hello&quot; onClick=&quot;showAndroidToast(&apos;Hello Android!&apos;)&quot; /&gt;

&lt;script type=&quot;text/javascript&quot;&gt;
    function showAndroidToast(toast) 
    {
        Android.showToast(toast);
    }
&lt;/script&gt;
</code></pre><p>#####特别注意：需要设置chrome handler</p>
<pre><code> // 如果不设置这个，JS代码中的按钮会显示，但是按下去却不弹出对话框
// Sets the chrome handler. This is an implementation of WebChromeClient
// for use in handling JavaScript dialogs, favicons, titles, and the
// progress. This will replace the current handler.
myWebView.setWebChromeClient(new WebChromeClient()
{

    @Override
    public boolean onJsAlert(WebView view, String url, String message,
            JsResult result)
    {
        // TODO Auto-generated method stub
        return super.onJsAlert(view, url, message, result);
    }

});
</code></pre><p>####二、Android 调用JavaScript代码<br>这个还比较简单，需要调用的时候只需要一行代码：　　</p>
<pre><code>myWebView.loadUrl(&quot;javascript:myFunction()&quot;);
</code></pre><p>　　其中myFunction()是JS函数。</p>
<p>　　这里要补充一下，如果JavaScript函数是带参数的，那么调用时要特别注意。</p>
<p>　　比如下面这个JS函数，在原来内容上加入一行：</p>
<pre><code>function writeLine(string)
{
    console.log(&quot;Write a new Line&quot;);//调试信息
    document.getElementById(&quot;content&quot;).innerHTML += string + &quot;&lt;br /&gt;&quot;;//在content标签段落加入新行
}
</code></pre><p>　　注：其中content是自定义的标签，html中有一个段落是：</p>
<pre><code>&lt;p id=&quot;content&quot;&gt;&lt;/p&gt;
</code></pre><p>　　那么在Android代码中调用这个writeLine()函数时，需要传入一个字符串参数，比如，想要传入一个叫name的String：</p>
<pre><code>myWebView.loadUrl(&quot;javascript:writeLine(&apos;&quot;+name+&quot;&apos;)&quot;);//JS代码要是带参数
</code></pre><p>　　还有就是要注意双引号中的函数名一定不要写错。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/12/17/Android中WebView使用之一（基础用法）/" itemprop="url">
                  Android中WebView使用之一（基础用法）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-12-17T16:41:51+08:00" content="2015-12-17">
              2015-12-17
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>###WebView基础使用<br>WebView是View的一个子类，可以让你在activity中显示网页。</p>
<p>　　可以在布局文件中写入WebView：比如下面这个写了一个填满整个屏幕的WebView：　</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;WebView  xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    android:id=&quot;@+id/webview&quot;
    android:layout_width=&quot;fill_parent&quot;
    android:layout_height=&quot;fill_parent&quot;
/&gt;
</code></pre><p>　　加载一个网页，使用loadUrl()：</p>
<pre><code>WebView myWebView = (WebView) findViewById(R.id.webview);
myWebView.loadUrl(&quot;http://www.example.com&quot;);
</code></pre><p>####一、设置WebView要现实的网页</p>
<p>设置WevView要显示的网页方法有很多：</p>
<p>　　互联网页面直接用：　</p>
<pre><code>myWebView.loadUrl(&quot;http://www.google.com&quot;);
</code></pre><p>　　本地文件用：</p>
<pre><code>myWebView.loadUrl(&quot;file:///android_asset/XX.html&quot;);  
</code></pre><p>　　本地文件存放在：assets文件中。</p>
<p>　　还可以直接载入html的字符串，如：</p>
<pre><code>String htmlString = &quot;&lt;h1&gt;Title&lt;/h1&gt;&lt;p&gt;This is HTML text&lt;br /&gt;&lt;i&gt;Formatted in italics&lt;/i&gt;&lt;br /&gt;Anothor Line&lt;/p&gt;&quot;;
// 载入这个html页面
myWebView.loadData(htmlString, &quot;text/html&quot;, &quot;utf-8&quot;);
</code></pre><p>打开页面时， 自适应屏幕：</p>
<pre><code>WebSettings webSettings =   mWebView .getSettings();       
webSettings.setUseWideViewPort(true);//设置此属性，可任意比例缩放
webSettings.setLoadWithOverviewMode(true);
</code></pre><p>便页面支持缩放：</p>
<pre><code>WebSettings webSettings =   mWebView .getSettings();       
webSettings.setJavaScriptEnabled(true);  
webSettings.setBuiltInZoomControls(true);
webSettings.setSupportZoom(true);
</code></pre><p>如果webView中需要用户手动输入用户名、密码或其他，则webview必须设置支持获取手势焦点。</p>
<pre><code>webview.requestFocusFromTouch();
</code></pre><p>####二、在WebView中使用JavaScript</p>
<p>如果你想要载入的页面中用了JavaScript，你必须为你的WebView使用JavaScript。</p>
<p>一旦使用之后，你也可以自己创建接口在你的应用和JavaScript代码间进行交互。</p>
<p>使用JavaScript可以通过getSettings()获得WebSettings，然后用setJavaScriptEnabled()使能JavaScript：</p>
<pre><code>WebView myWebView = (WebView) findViewById(R.id.webview);
WebSettings webSettings = myWebView.getSettings();
webSettings.setJavaScriptEnabled(true);
</code></pre><p>WebSettings中提供了很多有用的设置。</p>
<pre><code>setJavaScriptEnabled(true);  //支持js

setPluginsEnabled(true);  //支持插件 

setUseWideViewPort(false);  //将图片调整到适合webview的大小 

setSupportZoom(true);  //支持缩放 

setLayoutAlgorithm(LayoutAlgorithm.SINGLE_COLUMN); //支持内容重新布局  

supportMultipleWindows();  //多窗口 

setCacheMode(WebSettings.LOAD_CACHE_ELSE_NETWORK);  //关闭webview中缓存 

setAllowFileAccess(true);  //设置可以访问文件 

setNeedInitialFocus(true); //当webview调用requestFocus时为webview设置节点

webview webSettings.setBuiltInZoomControls(true); //设置支持缩放 

setJavaScriptCanOpenWindowsAutomatically(true); //支持通过JS打开新窗口 

setLoadWithOverviewMode(true); // 缩放至屏幕的大小

setLoadsImagesAutomatically(true);  //支持自动加载图片
</code></pre><p>####三、处理页面浏览<br>当用户点击了你的WebView中的一个链接，默认的行为是Android启动一个处理URL的应用，通常，默认的浏览器打开并下载目标URL。</p>
<p>但是，你可以在你的WebView中覆盖这一行为，使得连接仍在你的WebView中打开。</p>
<p>之后，根据在WebView中维护的网页浏览历史，你可以允许用户向前或向后浏览他们的网页。</p>
<p>#####在WebView中打开所有链接</p>
<p>要打开用户点击的链接，只需要用setWebViewClient()方法向你的WebView提供一个WebViewClient 比如：</p>
<pre><code>WebView myWebView = (WebView) findViewById(R.id.webview);
myWebView.setWebViewClient(new WebViewClient());
</code></pre><p>此时就OK了， 就可以在你的WebView中打开链接了。</p>
<p>#####关于打开链接位置的更多控制<br>如果你对在哪里打开链接需要更多的控制，你可以创建自己的类，继承 WebViewClient，然后覆写shouldOverrideUrlLoading() 方法。</p>
<p>　　比如下面这个：</p>
<pre><code>private class MyWebViewClient extends WebViewClient
{
    @Override
    public boolean shouldOverrideUrlLoading(WebView view, String url)
    {

　　　　　　　if(Uri.parse(url).getHost().equals(www.example.com))
        {
            return false;
        }
        Intent intent = new Intent(Intent.ACTION_VIEW, Uri.parse(url));
        startActivity(intent);
        return true;
    }
}
</code></pre><p>将特定的链接用自己的WebView打开，其他链接用浏览器（intent启动了默认的处理URL的Activity）。</p>
<p>定义完之后把这个类的对象传入setWebViewClient()方法即可。　</p>
<pre><code>WebView myWebView = (WebView) findViewById(R.id.webview);
myWebView.setWebViewClient(new MyWebViewClient());
</code></pre><p>#####浏览网页历史回退<br>当你的WebView覆写了URL载入的行为，它会自动地对访问过的网页积累一个历史，你可以利用 goBack() 和 goForward()方法在这个历史中前进或后退。</p>
<p>比如说使用后退键进行网页后退：</p>
<pre><code>/**
 * 按键响应，在WebView中查看网页时，按返回键的时候按浏览历史退回,如果不做此项处理则整个WebView返回退出
 */
@Override
public boolean onKeyDown(int keyCode, KeyEvent event)
{
    // Check if the key event was the Back button and if there&apos;s history
    if ((keyCode == KeyEvent.KEYCODE_BACK) &amp;&amp; myWebView.canGoBack())
    {
        // 返回键退回
        myWebView.goBack();
        return true;
    }
    return super.onKeyDown(keyCode, event);
}
</code></pre><p>canGoBack() 方法在网页可以后退时返回true。</p>
<p>类似的，canGoForward()方法可以检查是否有可以前进的历史记录。</p>
<p>如果你不执行这种检查，一旦 goBack() 和 goForward()方法到达历史记录顶端，它们将什么也不做。</p>
<p>如果不加这种设置，在用户按下Back键时，如果是WebView显示网页，则会将WebView作为整体返回。</p>
<p>#####WebViewClient方法详解</p>
<pre><code>doUpdateVisitedHistory(WebView view, String url, boolean isReload)  //(更新历史记录) 

onFormResubmission(WebView view, Message dontResend, Message resend) //(应用程序重新请求网页数据) 

onLoadResource(WebView view, String url) // 在加载页面资源时会调用，每一个资源（比如图片）的加载都会调用一次。 

onPageStarted(WebView view, String url, Bitmap favicon) //这个事件就是开始载入页面调用的，通常我们可以在这设定一个loading的页面，告诉用户程序在等待网络响应。 

onPageFinished(WebView view, String url) //在页面加载结束时调用。同样道理，我们知道一个页面载入完成，于是我们可以关闭loading 条，切换程序动作。 

onReceivedError(WebView view, int errorCode, String description, String failingUrl)// (报告错误信息) 

onReceivedHttpAuthRequest(WebView view, HttpAuthHandler handler, String host,String realm)//（获取返回信息授权请求） 

onReceivedSslError(WebView view, SslErrorHandler handler, SslError error) //重写此方法可以让webview处理https请求。

onScaleChanged(WebView view, float oldScale, float newScale) // (WebView发生改变时调用) 

onUnhandledKeyEvent(WebView view, KeyEvent event) //（Key事件未被加载时调用） 

shouldOverrideKeyEvent(WebView view, KeyEvent event)//重写此方法才能够处理在浏览器中的按键事件。 

shouldOverrideUrlLoading(WebView view, String url) 
//在点击请求的是链接是才会调用，重写此方法返回true表明点击网页里面的链接还是在当前的webview里跳转，不跳到浏览器那边。这个函数我们可以做很多操作，比如我们读取到某些特殊的URL，于是就可以不打开地址，取消这个操作，进行预先定义的其他操作，这对一个程序是非常必要的。
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/12/15/仿QQ好友列表/" itemprop="url">
                  仿QQ好友列表
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-12-15T17:28:06+08:00" content="2015-12-15">
              2015-12-15
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>前段时间，朋友不经意间就说起了那天发生的事，一个ios面试者去他公司面试，让他直接做一个QQ好友列表，那哥们不会，被他彻底的鄙视了一番，马丹，我一听，草，我也不会啊，然后我就默默的记住了，回来去查了下资料写了下。</p>
<h3>唉，我太菜了，学无止境啊</h3>

<p>进入正题：</p>
<p>其实就是用到了<b>ExpandableListView</b>这个组件，用法和listview相似。</p>
<p>####一、默认图标</p>
<p>在Activity的布局文件中</p>
<pre><code>&lt;RelativeLayout 
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;
    &gt;

    &lt;ExpandableListView
        android:id=&quot;@+id/expanded_list&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;match_parent&quot;
        android:divider=&quot;@null&quot;
        android:scrollbars=&quot;none&quot;/&gt;
&lt;/RelativeLayout&gt;
</code></pre><p>然后在Activity中</p>
<pre><code>public class MainActivity extends AppCompatActivity {

    ExpandableListView expandablelistview;
    //群组名称
    private String[] group = new String[] { &quot;在线好友&quot;, &quot;我的好友&quot;, &quot;我的同事&quot;};
    //好友名称
    private String[][] buddy = new String[][] {
            { &quot;元芳&quot;, &quot;雷丶小贱&quot;, &quot;狄大人&quot;},
            {&quot;高太后&quot;, &quot;士兵甲&quot;, &quot;士兵乙&quot;, &quot;士兵丙&quot; },
            { &quot;艺术家&quot;, &quot;叫兽&quot;, &quot;攻城师&quot;, &quot;职业玩家&quot; }};
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);


        expandablelistview= (ExpandableListView) findViewById(R.id.expanded_list);
        ExpandableListAdapter adapter=new BuddyAdapter();
        expandablelistview.setAdapter(adapter);
        expandablelistview.setOnChildClickListener(new ExpandableListView.OnChildClickListener() {
            @Override
            public boolean onChildClick(ExpandableListView parent, View v, int groupPosition, int childPosition, long id) {
                Toast.makeText(MainActivity.this,buddy[groupPosition][childPosition].toString(),Toast.LENGTH_SHORT).show();
                return true;
            }
        });
    }

    class BuddyAdapter extends BaseExpandableListAdapter {

        @Override
        public int getGroupCount() {
            return group.length;
        }

        @Override
        public int getChildrenCount(int groupPosition) {
            return buddy[groupPosition].length;
        }

        @Override
        public Object getGroup(int groupPosition) {
            return group[groupPosition];
        }

        @Override
        public Object getChild(int groupPosition, int childPosition) {
            return buddy[groupPosition][childPosition];
        }

        @Override
        public long getGroupId(int groupPosition) {
            return groupPosition;
        }

        @Override
        public long getChildId(int groupPosition, int childPosition) {
            return childPosition;
        }

        @Override
        public boolean hasStableIds() {
            return true;
        }

        @Override
        public View getGroupView(int groupPosition, boolean isExpanded, View convertView, ViewGroup parent) {
            TextView textView = getTextView();//调用定义的getTextView()方法
            textView.setText(getGroup(groupPosition).toString());//添加数据
            return textView;
        }

        @Override
        public View getChildView(int groupPosition, int childPosition, boolean isLastChild, View convertView, ViewGroup parent) {
            LinearLayout ll = new LinearLayout(MainActivity.this);
            ll.setOrientation(LinearLayout.HORIZONTAL);//定义为纵向排列
            ImageView logo = new ImageView(MainActivity.this);
            logo.setImageResource(R.mipmap.ic_launcher);//添加图片
            ll.addView(logo);
            TextView textView = getTextView();//调用定义的getTextView()方法
            LinearLayout.LayoutParams params=new LinearLayout.LayoutParams(ViewGroup.LayoutParams.WRAP_CONTENT, ViewGroup.LayoutParams.WRAP_CONTENT);
            params.gravity= Gravity.CENTER;
            textView.setLayoutParams(params);
            textView.setText(getChild(groupPosition,childPosition).toString());//添加数据
            ll.addView(textView);
            return ll;
        }

        @Override
        public boolean isChildSelectable(int groupPosition, int childPosition) {
            return true;
        }
    }

    private TextView getTextView() {
        AbsListView.LayoutParams lp = new AbsListView.LayoutParams(ViewGroup.LayoutParams.FILL_PARENT,100);
        TextView textView = new TextView(MainActivity.this);
        textView.setLayoutParams(lp);
        textView.setPadding(100, 0, 0, 0);
        textView.setTextSize(20);
        return textView;
    }

}
</code></pre><p>效果图：<br><img src="http://7xl32g.com1.z0.glb.clouddn.com/仿QQ好友列表.gif"></p>
<p>####二、自定义列表图标</p>
<p><li>1、更改自定义图标</li></p>
<p>在drawable文件夹下新建expandablelistview_change.xml</p>
<pre><code>&lt;?xml version = &quot;1.0&quot;   encoding = &quot;utf-8&quot;?&gt;
&lt;selector   xmlns:android = &quot;http://schemas.android.com/apk/res/android&quot; &gt;      
     &lt;item android:state_expanded = &quot;true&quot;   android:drawable = &quot;@drawable/w2&quot;/&gt;      
     &lt;item android:drawable = &quot;@drawable/w1&quot;/&gt;      
&lt;/selector &gt;
</code></pre><p><li>2.修改布局文件中Expandablelistview的属性等</li></p>
<pre><code>&lt;ExpandableListView
    android:id=&quot;@+id/expanded_list&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;
    android:divider=&quot;@null&quot;
    android:scrollbars=&quot;none&quot;
    android:groupIndicator=&quot;@drawable/expandablelistview_change&quot;/&gt;   //就是添加这个
</code></pre><p><li>3.如果想让图标放在右边可以这样做：</li></p>
<pre><code>// 得到屏幕的大小
DisplayMetrics dm = new DisplayMetrics();
getWindowManager().getDefaultDisplay().getMetrics(dm);
//图标设置在右边
getExpandableListView().setIndicatorBounds(dm.widthPixels-60, dm.widthPixels); // 设置指示图标的位置
</code></pre><p></p><h1>引以为戒<p></p>
</h1>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/10/31/Android-夜间模式的简单实现/" itemprop="url">
                  Android 夜间模式的简单实现
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-10-31T10:29:58+08:00" content="2015-10-31">
              2015-10-31
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>夜间模式的实现，是关于Theme的设置。在Activity中有一个方法叫setTheme()，可以设置Activity的Theme，当然Application类中也有相同的方法，也可以在Application中设置当前应用的Theme。就好像我们可以在Manifest文件中通过android:theme=“”来设置主题一样。</p>
<p>实现流程：</p>
<p>###一、创建属性名<br>在<code>res/value</code>目录下新建一个attr文件，并添加两个item，如下：</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;resources&gt;
    &lt;attr name=&quot;text_color&quot; format=&quot;reference|color&quot; /&gt;
    &lt;attr name=&quot;text_bg_color&quot; format=&quot;reference|color&quot; /&gt;
&lt;/resources&gt;
</code></pre><p>其中text_bg和text_bg_color就是我们定义的两个属性名，后面的format是指的这个属性名的类型，这里我是用reference|color表示既可以是一个引用，也可以是一个argb颜色值。除了这些你还可以选择int，boolan，string等数据类型。</p>
<p>###二、定义资源样式<br>创建完属性名后就需要创建主题样式了。依旧在res/values/下新建一个xml文件，或者也可以在原style.xml中写，是一样的。 我们需要在这里定义步骤一中定义的各属性名在当前主题下的值。</p>
<pre><code>&lt;style name=&quot;Dark&quot; parent=&quot;AppTheme&quot;&gt;
    &lt;item name=&quot;text_color&quot;&gt;@color/black_text&lt;/item&gt;
    &lt;item name=&quot;text_bg_color&quot;&gt;@color/white&lt;/item&gt;
&lt;/style&gt;

 &lt;style name=&quot;Light&quot; parent=&quot;AppTheme&quot;&gt;
    &lt;item name=&quot;text_color&quot;&gt;@color/black_text&lt;/item&gt;
    &lt;item name=&quot;text_bg_color&quot;&gt;@color/white&lt;/item&gt;    //也可以选择器
&lt;/style&gt;
</code></pre><p>###三、布局中使用<br>     <textview android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="第一" android:layout_margin="5dp" android:background="?text_bg_color" 这样使用="" android:textcolor="?text_color" android:textsize="25sp"><br>因为应用夜间模式的Textview控件很多，抽取为一个样式在引用</textview></p>
<pre><code>&lt;style name=&quot;TextStyle&quot;&gt;
    &lt;item name=&quot;android:background&quot;&gt;?text_bg_color&lt;/item&gt;
    &lt;item name=&quot;android:textColor&quot;&gt;?text_color&lt;/item&gt;
&lt;/style&gt;
</code></pre><p>然后这样使用</p>
<pre><code>&lt;TextView
   android:layout_width=&quot;wrap_content&quot;
   android:layout_height=&quot;wrap_content&quot;
   android:text=&quot;第一&quot;
   style=&quot;@style/TextStyle&quot;
   android:layout_margin=&quot;5dp&quot;
   android:textSize=&quot;25sp&quot; /&gt;
</code></pre><p>###四、代码中使用<br>在要切换夜间模式的Activity使用<code>setTheme</code>方法：</p>
<pre><code>/**
 * 设置为日间模式
 */

public void setLight() {
    LLogUtils.i(&quot;设置为日间模式&quot;);
    setTheme(R.style.Light);
    CacheUtil.save(IS_NIGHT, false);
    super.recreate();
}

/**
 * 设置为夜间模式
 */
public void setNight() {
    LLogUtils.i(&quot;设置为夜间模式&quot;);
    setTheme(R.style.Dark);
    CacheUtil.save(IS_NIGHT, true);
    super.recreate();
}
</code></pre><p>效果图：</p>
<p><img src="http://7xniib.com1.z0.glb.clouddn.com/darkandnight.gif"></p>
<p>如果需要在开启Activity的时候根据以前的配置，需要重写Activity中的<code>setContentView</code>方法中调用：</p>
<pre><code>@Override
public void setContentView(int layoutResID) {
    if (CacheUtil.getBoolean(IS_NIGHT)) {
        LLogUtils.i(&quot;设置为夜间模式&quot;);
        setTheme(R.style.Dark);
        CacheUtil.save(IS_NIGHT, true);
    }
    super.setContentView(layoutResID);

}
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/10/29/Android如何从系统图库中选择图片/" itemprop="url">
                  Android如何从系统图库中选择图片
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-10-29T10:31:16+08:00" content="2015-10-29">
              2015-10-29
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>###一、给按钮一个点击事件，重定向到图片库的代码：</p>
<pre><code>Intent i = new Intent(
Intent.ACTION_PICK, android.provider.MediaStore.Images.Media.EXTERNAL_CONTENT_URI);

startActivityForResult(i, RESULT_LOAD_IMAGE);
</code></pre><p>注意：这里要传一个整形的常量<b>RESULT_LOAD_IMAGE</b>到startActivityForResult()方法。</p>
<p>###二、一旦用户选择了一张图片，onActivityResult()方法将会被调用。我们需要处理这个方法得到的数据，代码如下：</p>
<pre><code>@Override
protected void onActivityResult(int requestCode, int resultCode, Intent data) {
    super.onActivityResult(requestCode, resultCode, data);

    if (requestCode == RESULT_LOAD_IMAGE &amp;&amp; resultCode == RESULT_OK &amp;&amp; null != data) {
        Uri selectedImage = data.getData();
        String[] filePathColumn = { MediaStore.Images.Media.DATA };

        Cursor cursor = getContentResolver().query(selectedImage,
                filePathColumn, null, null, null);
        cursor.moveToFirst();

        int columnIndex = cursor.getColumnIndex(filePathColumn[0]);
        String picturePath = cursor.getString(columnIndex);    //此处就获得了选中图片的路径，可以对其进行操作
        cursor.close();

        // String picturePath contains the path of selected Image
        Log.i(picturePath)  
  }
</code></pre><p>注意：onActivityResult()方法只有当图片被选中后才会调用。</p>
<p>在这个方法中，我们需要检查requestCode是否是我们之前传给startActivityForResult()方法的<b>RESULT_LOAD_IMAGE</b>。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="John Doe" />
          <p class="site-author-name" itemprop="name">John Doe</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">33</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  
  

  

  

</body>
</html>
